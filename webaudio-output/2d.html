<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <style>
      html {
        height: 100%;
      }

      body {
        background: black;
        overflow: hidden;
        margin: 0;
        font-family: 'Titillium Web', sans-serif;
        color: white;
        height: 100%;
      }

      .annotation {
        position: absolute;
        bottom: 32px;
        left: 32px;
        width: calc(100% - 198px);
        -webkit-user-select: none;
        user-select: none;
        pointer-events: none;
      }

      @media (width < 768px) {
        .annotation {
          bottom: 8px;
          left: 8px;
        }
      }

      .annotation h1 {
        font-size: 3rem;
        font-weight: bold;
        margin: 0;
      }

      @media (width < 768px) {
        .annotation h1 {
          font-size: 1.5rem;
        }
      }

      .annotation p {
        font-size: 1rem;
        margin: 0;
      }

      button {
        appearance: none;
        border: none;
        background: transparent;
        cursor: pointer;
        font-family: inherit;
        -webkit-user-select: none;
        user-select: none;
      }

      #btnPlay {
        position: absolute;
        bottom: 32px;
        right: 32px;
        font-size: 1.5rem;
        font-weight: bold;
        padding: 8px 0;
        width: 128px;
        border-radius: 32px;
        background: rgba(0, 0, 0, 0.25);
        color: white;
        transition: 0.2s;
        border: 1px solid #006edc;
      }

      #btnPlay:hover {
        box-shadow:
          #0777f5ff 0px 0px 10px 0px,
          #367ce47f 0px 0px 20px 0px;
      }

      @media (width < 768px) {
        #btnPlay {
          width: 96px;
          font-size: 1rem;
          bottom: 8px;
          right: 8px;
        }
      }

      .container {
        display: flex;
        width: 100%;
        height: 100%;
        justify-content: center;
        align-items: center;
        gap: 1px;
        padding: 16px;
        box-sizing: border-box;
      }

      @media (width < 365px) {
        .container {
          gap: 0;
        }
      }

      .container:after {
        content: '';
        display: block;
        width: 100%;
        height: 1px;
        position: absolute;
        top: 50%;
        left: 0;
        background: #006edc;
      }

      .box {
        flex: 1;
        height: 100%;
        scale: 1 0;
        background: #fff;
      }
    </style>
    <script type="module">
      const FFT_SIZE = 512
      const containerElement = document.querySelector('.container')
      const boxes = Array.from({ length: FFT_SIZE / 2 }, () => {
        const div = document.createElement('div')
        div.classList.add('box')
        containerElement.append(div)
        return div
      })

      let nodeAnalyzer = null

      async function initSound() {
        const stream = await navigator.mediaDevices.getUserMedia({
          audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true },
        })
        const context = new AudioContext()
        nodeAnalyzer = context.createAnalyser()
        nodeAnalyzer.fftSize = FFT_SIZE
        nodeAnalyzer.smoothingTimeConstant = 0.85

        const nodeSource = context.createMediaStreamSource(stream)
        nodeSource.connect(nodeAnalyzer)
      }

      function draw() {
        if (!nodeAnalyzer) return
        const freqByteData = new Uint8Array(FFT_SIZE / 2)
        nodeAnalyzer.getByteFrequencyData(freqByteData)
        freqByteData.forEach((value, i) => {
          boxes[i].style.scale = `1 ${value / 256}`
        })
      }

      function loop() {
        requestAnimationFrame(loop)
        draw()
      }

      document.querySelector('#btnPlay').addEventListener('click', () => initSound())

      loop()
    </script>
  </head>

  <body>
    <div class="container"></div>
    <button id="btnPlay">PLAY</button>
  </body>
</html>
